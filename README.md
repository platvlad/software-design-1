[![Build Status](https://travis-ci.org/AlexKaneRUS/software-design.svg?branch=cli)](https://travis-ci.org/AlexKaneRUS/software-design)

# CLI

## Сборка проекта

Для сборки проекта используется инструмент stack, установить который можно,
воспользовавшись [данной](https://docs.haskellstack.org/en/stable/README/) ссылкой.

После установки stack проект можно будет собрать из его корневой директории
следующей командой: 

```
stack build
```

## Запуск проекта

Запуск интерпретатора происходит из корневой директории с помощью команды:

```
stack exec cli
```

## Запуск тестов

Запуск тестов происходит из корневой директории с помощью команды:

```
stack test
```

## Логика работы

Сначала интерпретатор принимает с консоли на вход сторку с командой от пользователя.
Дальше команда перенаправляется компоненту Preprocessor, который, используя текущее состояние системы,
производит в строке замены переменных. После этого строка с заменёнными переменными
отправляется в компонеент Parser, который собирает из неё цельный пайплайн, представляющий
из себя просто список команд во внутреннем представлении CLI. 
Далее модуль Executor, отвечающий за исполнение пайплайна,
исполняет его, на каждом шаге работы записывая в глобальную переменную stream информацию
о том, что являлось stdout'ом последней исполненной им команды. После этого компонент
Runner выводит в stdout интерпретатора текущее значение переменной stream
и обнуляет её.

Эта схема представлена на картинке ниже:

![Схема работы CLI](/images/schema.png)